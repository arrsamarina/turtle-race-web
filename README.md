# Черепашьи бега (Turtle Race)

Веб-версия настольной игры "Черепашьи бега" - стратегической карточной игры, где игроки управляют черепахами разных цветов, перемещая их по треку к финишу.

## Описание

"Черепашьи бега" - это многопользовательская онлайн-игра, основанная на классической настольной игре. Игроки получают случайную черепаху и карты, с помощью которых перемещают черепах по треку. Цель игры - привести свою черепаху к финишу первой, не раскрывая её принадлежность другим игрокам.

### Основные особенности

- Многопользовательская игра (2-5 игроков)
- Карточная механика с различными типами карт
- Трек с 10 клетками + зона "до старта"
- 5 черепах разных цветов (синяя, зелёная, розовая, фиолетовая, жёлтая)
- Система башен (черепахи могут вставать друг на друга)
- Таймер хода с настраиваемой длительностью
- Ретро-стиль с LCD-шрифтом и анимированным фоном
- Адаптивный интерфейс

## Технологии

### Frontend
- **HTML5** - структура страниц
- **CSS3** - стилизация и анимации
- **JavaScript (Vanilla)** - игровая логика и взаимодействие с API
- **LocalStorage** - хранение токенов аутентификации

### Backend
- **PHP 7.4+** - серверная логика
- **PostgreSQL** - база данных
- **PDO** - работа с базой данных

### Архитектура
- RESTful API для взаимодействия фронтенда и бэкенда
- JSON для обмена данными
- Polling для обновления состояния игры (каждые 2 секунды)

## Структура проекта

```
turtle-race-web/
├── backend/
│   ├── api/                    # API endpoints
│   │   ├── authorize_user.php
│   │   ├── create_game_room.php
│   │   ├── get_state.php
│   │   ├── join_game_room.php
│   │   ├── leave_game.php
│   │   ├── leave_lobby.php
│   │   ├── list_open_rooms.php
│   │   ├── logout_user.php
│   │   ├── make_move.php
│   │   ├── register_user.php
│   │   └── start_game.php
│   └── db.php                  # Подключение к базе данных
├── css/
│   └── style.css               # Основные стили
├── fonts/
│   └── LCD5x8HRU.woff2         # LCD-шрифт
├── icons/                       # Иконки стрелок и черепах
├── images/
│   ├── cards/                   # Изображения карт
│   ├── flags/                   # Флаги старта и финиша
│   └── turtles/                 # Изображения черепах
├── js/
│   ├── api.js                   # Функции для работы с API
│   └── main.js                  # Основная логика и анимации
├── create-room.html             # Страница создания комнаты
├── game-rules.html              # Правила игры
├── game.html                    # Игровое поле
├── index.html                   # Главная страница
├── login.html                   # Страница входа
├── menu.html                    # Главное меню
├── open-rooms.html              # Список открытых комнат
├── register.html                # Страница регистрации
└── room-lobby.html              # Лобби перед игрой
```

## Требования

### Сервер
- **PHP 7.4+** с расширениями:
  - `pdo`
  - `pdo_pgsql`
  - `json`
- **PostgreSQL 12+**
- **Веб-сервер** (Apache/Nginx) с поддержкой PHP

### Браузер
- Современный браузер с поддержкой:
  - ES6+ JavaScript
  - LocalStorage API
  - Fetch API
  - CSS Grid/Flexbox

## Установка

### 1. Клонирование репозитория

```bash
git clone <repository-url>
cd turtle-race-web
```

### 2. Настройка базы данных

1. Создайте базу данных PostgreSQL:
```sql
CREATE DATABASE turtle_race;
```

2. Импортируйте схему базы данных (если есть SQL-скрипт):
```bash
psql -U your_user -d turtle_race -f schema.sql
```

3. Убедитесь, что в базе данных созданы необходимые функции:
   - `register_user(p_login, p_password)`
   - `authorize_user(p_login, p_password)`
   - `create_game_room(p_token, p_players_count, p_turn_duration)`
   - `get_game_state_json(p_token, p_game_id)`
   - И другие функции для игровой логики

### 3. Настройка подключения к базе данных

Отредактируйте файл `backend/db.php`:

```php
$host     = "your_host";      // Например: "localhost"
$port     = "5432";           // Порт PostgreSQL
$dbname   = "turtle_race";   // Имя базы данных
$user     = "your_user";      // Пользователь БД
$password = "your_password"; // Пароль
```

### 4. Настройка веб-сервера

#### Apache
Создайте виртуальный хост или используйте `.htaccess`:

```apache
<VirtualHost *:80>
    ServerName turtle-race.local
    DocumentRoot /path/to/turtle-race-web
    
    <Directory /path/to/turtle-race-web>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>
```

#### Nginx
```nginx
server {
    listen 80;
    server_name turtle-race.local;
    root /path/to/turtle-race-web;
    index index.html;

    location / {
        try_files $uri $uri/ =404;
    }

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }
}
```

### 5. Проверка установки

1. Откройте браузер и перейдите по адресу вашего сервера
2. Вы должны увидеть главную страницу с анимированными черепахами
3. Попробуйте зарегистрировать нового пользователя

## Использование

### Регистрация и вход

1. На главной странице нажмите на заголовок "ЧЕРЕПАШЬИ БЕГА"
2. Зарегистрируйте новый аккаунт или войдите в существующий
3. После успешной авторизации вы попадёте в главное меню

### Создание игры

1. В меню выберите "СОЗДАТЬ КОМНАТУ"
2. Укажите количество игроков (2-5)
3. Установите длительность хода (в секундах)
4. Нажмите "СОЗДАТЬ"
5. Дождитесь, пока другие игроки присоединятся к комнате
6. Когда все игроки готовы, нажмите "НАЧАТЬ ИГРУ"

### Присоединение к игре

1. В меню выберите "ИГРОВЫЕ КОМНАТЫ"
2. Выберите открытую комнату из списка
3. Нажмите "ПРИСОЕДИНИТЬСЯ"
4. Дождитесь начала игры

### Игровой процесс

1. В начале игры вы получите случайную черепаху и 5 карт
2. В свой ход выберите карту из руки
3. Для универсальных карт выберите целевую черепаху
4. Черепахи перемещаются по треку согласно картам
5. Цель - привести свою черепаху к финишу первой

## Правила игры

### Основные правила

- Каждый игрок получает случайную черепаху и не знает, какие черепахи принадлежат другим игрокам
- В свой ход игрок обязан разыграть одну карту
- Карты определяют перемещение черепах:
  - **Вперёд** на 1 или 2 клетки
  - **Назад** на 1 клетку
- Цветные карты перемещают черепаху соответствующего цвета
- Универсальные карты позволяют выбрать любую черепаху или последнюю черепаху
- Нельзя ходить назад со старта (клетка 0) или из зоны "до старта"

### Башни

- Если черепаха перемещается на клетку, где уже есть другая черепаха, она встаёт на неё
- При перемещении нижней черепахи все черепахи в башне перемещаются вместе
- Победителем считается черепаха, которая первой достигла финиша (клетка 9)

### Завершение игры

- Игра заканчивается, когда любая черепаха достигает финиша
- После завершения раскрывается принадлежность всех черепах
- Итоговые места определяются по позициям черепах игроков на треке

## API Документация

Все API endpoints находятся в `backend/api/` и принимают JSON в теле запроса.

### Аутентификация

#### Регистрация
```
POST /backend/api/register_user.php
Body: { "login": "string", "password": "string" }
Response: { "status": "ok", "token": "string" }
```

#### Вход
```
POST /backend/api/authorize_user.php
Body: { "login": "string", "password": "string" }
Response: { "status": "ok", "token": "string" }
```

#### Выход
```
POST /backend/api/logout_user.php
Body: { "token": "string" }
Response: { "status": "ok" }
```

### Игровые комнаты

#### Создание комнаты
```
POST /backend/api/create_game_room.php
Body: { "token": "string", "players_count": int, "turn_duration": "string" }
Response: { "status": "ok", "game_id": int }
```

#### Список открытых комнат
```
POST /backend/api/list_open_rooms.php
Body: { "token": "string" }
Response: { "status": "ok", "rooms": [...] }
```

#### Присоединение к комнате
```
POST /backend/api/join_game_room.php
Body: { "token": "string", "game_id": int }
Response: { "status": "ok" }
```

#### Выход из лобби
```
POST /backend/api/leave_lobby.php
Body: { "token": "string", "game_id": int }
Response: { "status": "ok" }
```

#### Начало игры
```
POST /backend/api/start_game.php
Body: { "token": "string", "game_id": int }
Response: { "status": "ok" }
```

### Игровой процесс

#### Получение состояния игры
```
POST /backend/api/get_state.php
Body: { "token": "string", "game_id": int }
Response: { "status": "ok", "game": {...}, "players": [...], "my_hand": [...], ... }
```

#### Выполнение хода
```
POST /backend/api/make_move.php
Body: { "token": "string", "game_id": int, "card_id": int, "target_turtle": int?, "return_hand": bool }
Response: { "status": "ok", "game": {...}, "my_hand": [...] }
```

#### Выход из игры
```
POST /backend/api/leave_game.php
Body: { "token": "string", "game_id": int }
Response: { "status": "ok" }
```

### Формат ответов

Все ответы имеют единый формат:

**Успех:**
```json
{
  "status": "ok",
  ...
}
```

**Ошибка:**
```json
{
  "status": "error",
  "error": "error_code",
  "message": "Описание ошибки"
}
```

## Отладка

### Включение отладки PHP

В файле `backend/db.php` уже включены:
```php
error_reporting(E_ALL);
ini_set('display_errors', 1);
```

### Логи браузера

Откройте консоль разработчика (F12) для просмотра:
- Запросов к API
- Состояния игры
- Ошибок JavaScript

### Проверка подключения к БД

Убедитесь, что:
1. PostgreSQL запущен
2. Параметры подключения в `backend/db.php` корректны
3. База данных создана и содержит необходимые функции
4. Пользователь БД имеет права на чтение/запись

## Лицензия

Этот проект создан в образовательных целях.

## Авторы

Проект разработан для изучения веб-разработки и создания многопользовательских игр. Автор - arrsamarina (Арина Самарина).

## Возможные улучшения

- [ ] WebSocket для real-time обновлений вместо polling
- [ ] Система рейтингов и статистики
- [ ] История игр
- [ ] Чат между игроками
- [ ] Звуковые эффекты
- [ ] Мобильная версия
- [ ] Темная/светлая тема
- [ ] Локализация (английский язык)

---

**Приятной игры!**
